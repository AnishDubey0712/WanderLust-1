<!-- This file will show listing details with edit and delete listing options -->
<!-- div row&col are made for centering of form and div=card is used from bootstrap webpage and use image.url for getting img -->
<%layout("/layouts/boilerplate")%>
<body>
    <div class="row mt-3">
        <div class="col-8 offset-3">
    <h3><%=listing.title%></h3> </div>
    <div class="card col-6 offset-3 show-card listing-card" >
        <img src="<%= listing.image%>" class="card-img-top show_img" alt="listing_image">
        <div class="card-body">
          <p class="card-text">
             <br>
             <b>Owned by :<%=listing.owner.username%></b> <br> 
            <%=listing.description%> <br>
            &#8377;<%=listing.price.toLocaleString("en-IN")%> <br>
            <%=listing.location%> <br>
            <%=listing.country%>
        </p>
        </div>
      </div>
    
<!--here we've written code for $ symbol and toLocaleString is for converitng price into string and then add commas. -->
<!-- If current user.id = owner then only he will get access to edit or delete   -->
<!-- We are comparing currUser to owner id if both matches then curruser will get access to edit & delete btn -->
<%if(currUser && currUser._id.equals(listing.owner._id)){%>
<div class="btns">
        <a href="/Listings/<%=listing._id%>/edit" class="btn btn-dark col-1 offset-3 edit-btn ">Edit</a>
        
   <form action="/Listings/<%=listing._id%>?_method=DELETE" method="post">
  <button class="btn btn-dark offset-5">Delete</button>
</form>
</div>
<%}%>
<div class="col-8 offset-3 mb-3">
    <hr>
    <h4>Leave a Review</h4>
    <!-- needs-validation logic is already written in script.js in public folder -->
    <form action="/Listings/<%=listing._id%>/reviews"method="post" novalidate class="needs-validation">
        <div class="mb-3 mt-3">
        <label for="rating" class="form-label">Rating:</label>
        <input type="range" min="1" max="5" name="review[rating]" id="rating" class="form-range"></div>
        <div class="mb-3 mt-3">
    <label for="comment" class="form-label">Comments</label>
    <textarea name="review[comment]" id="comment" cols="30" rows="5" class="form-control" required></textarea>
<div class="invalid-feedback">Please add some comments for review</div>
</div>
<button class="btn btn-outline-dark">Submit</button>
    </form>
    <hr>
    <p><b>Reviews</b></p>
    <div class="row">
    <%for(review of listing.reviews){%>
    <div class="card col-5 ms-3 mb-3">
        <div class="card-body">
            <h5 class="card-title">Elon Musk</h5>
            <p class="card-text"><%=review.comment%></p>
            <p class="card-text"> <%=review.rating%> stars</p>
        </div>
        <form action="/Listings/<%=listing._id%>/reviews/<%=review._id%>?_method=DELETE" method="post" class="mb-3">
            <button class="btn btn-sm btn-dark ">Delete</button>
        </form>
    </div>
    <%}%></div>
</div>
</div>
</body>
